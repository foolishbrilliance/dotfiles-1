#!/usr/bin/env bash
#
# dot
#
# `dot` handles installation, updates, things like that. Run it periodically
# to make sure you're on the latest and greatest.
source ~/.bash_colors
export ZSH=$HOME/.dotfiles

# Dotfiles
TARGET=Dotfiles; cd $ZSH && git pull && clr_green "Updated ${TARGET}." || clr_red "${TARGET} update failed."

# Grml zshrc
TARGET=GRML; cd ~/.grml-etc-core && git pull && clr_green clr_bold "Updated ${TARGET}." || clr_red "${TARGET} update failed."

# Vim
TARGET="Dein - VIM Plugin Manager"; cd ~/.vim/plugins/repos/github.com/Shougo/dein.vim && git pull && clr_green clr_bold "Updated ${TARGET}." ||
clr_red "${TARGET} update failed."
TARGET="VIM Plugins"; vim +'call dein#update()' +qall && clr_green clr_bold "Updated ${TARGET}" || clr_red "${TARGET} update failed."

# Doom Emacs
TARGET="Doom Emacs packages"; ~/.emacs.d/bin/doom update && clr_green clr_bold "Updated ${TARGET}." || clr_red "${TARGET} update failed."
TARGET="Doom Emacs"; ~/.emacs.d/bin/doom upgrade && clr_green clr_bold "Updated ${TARGET}." || clr_red "${TARGET} update failed."
TARGET="Doom Emacs"; ~/.emacs.d/bin/doom refresh && clr_green clr_bold "Updated ${TARGET} refreshed." || clr_red "${TARGET} refresh failed."

# Spacemacs
# emacs --batch --load=~/.emacs.d/init.el && clr_green clr_bold "Updated Emacs Packages." || clr_red "Emacs Packages update failed."
TARGET=Spacemacs; cd ~/.emacs.d.spacemacs && git pull --rebase && clr_green clr_bold "Updated ${TARGET}." || clr_red "${TARGET} update failed."

################################################################################
# Mac only for rest of script
################################################################################
if [ "$(uname)" != "Darwin" ]; then
  exit 0
fi

# Brew
cd
brew update
brew upgrade
brew cleanup -s
brew cask cleanup
# Diagnotics
brew doctor
brew missing

# Node
npm update -g

# Ruby
gem update && clr_green "Updated Ruby gems." || clr_red "Ruby gem update failed."

# Python
python3 -m pip install --upgrade pip
python2 -m pip install --upgrade pip
python3 -m pip install --upgrade setuptools
python2 -m pip install --upgrade setuptools
#pip freeze --local | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip install -U && clr_green "Updated pip packages." || clr_red "pip packages update failed."
pip3 freeze --local | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip3 install -U && clr_green "Updated pip3 packages." || clr_red "pip3 packages update failed."
pip2 freeze --local | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip2 install -U && clr_green "Updated pip2 packages." || clr_red "pip2 packages update failed."

if [[ $(mas outdated) ]]; then
  clr_brown "You can run 'mas upgrade' to upgrade theses apps from the app store:"
  mas outdated
else
  clr_green "Mac App Store up to date."
fi
